<!DOCTYPE html>




<html class="theme-next gemini" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="半自动化，游戏UI开发，Unity,MVC," />





  <link rel="alternate" href="/atom.xml" title="Veinin" type="application/atom+xml" />






<meta name="description" content="最近着手试了下我们客户端 UI 开发，发现整个流程对于开发人员来说并不是很友好，我们游戏客户端代码基本使用 Lua 语言进行，引擎则采用 Unity。对于 UI 模块目前有一套基本的 MVC 模式的开发流程，但这个开发模式的边界并没有处理很好，导致开发过程中异常艰难。编写代码的人员有时也会很懵逼，因为实现的方式可以有多种多样。 在了解了整个旧有的开发流程后，我发现个问题，其中由UI编辑到代码编写，">
<meta name="keywords" content="半自动化，游戏UI开发，Unity,MVC">
<meta property="og:type" content="article">
<meta property="og:title" content="开发笔记：游戏 UI 半自动化开发流程">
<meta property="og:url" content="https://veinin.com/2018/07/31/dev_notes-game-UI-semi-automated-development/index.html">
<meta property="og:site_name" content="Veinin">
<meta property="og:description" content="最近着手试了下我们客户端 UI 开发，发现整个流程对于开发人员来说并不是很友好，我们游戏客户端代码基本使用 Lua 语言进行，引擎则采用 Unity。对于 UI 模块目前有一套基本的 MVC 模式的开发流程，但这个开发模式的边界并没有处理很好，导致开发过程中异常艰难。编写代码的人员有时也会很懵逼，因为实现的方式可以有多种多样。 在了解了整个旧有的开发流程后，我发现个问题，其中由UI编辑到代码编写，">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://veinin.com/images/mvc/mvc_ui_design.png">
<meta property="og:image" content="https://veinin.com/images/mvc/mvc_pattern.png">
<meta property="og:image" content="https://veinin.com/images/mvc/mvc_controller_life_cycle.png">
<meta property="og:image" content="https://veinin.com/images/mvc/mvc_view_life_cycle.png">
<meta property="og:image" content="https://veinin.com/images/mvc/mvc_view_group.png">
<meta property="og:image" content="https://veinin.com/images/mvc/create_view.png">
<meta property="og:updated_time" content="2018-08-01T14:39:59.893Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="开发笔记：游戏 UI 半自动化开发流程">
<meta name="twitter:description" content="最近着手试了下我们客户端 UI 开发，发现整个流程对于开发人员来说并不是很友好，我们游戏客户端代码基本使用 Lua 语言进行，引擎则采用 Unity。对于 UI 模块目前有一套基本的 MVC 模式的开发流程，但这个开发模式的边界并没有处理很好，导致开发过程中异常艰难。编写代码的人员有时也会很懵逼，因为实现的方式可以有多种多样。 在了解了整个旧有的开发流程后，我发现个问题，其中由UI编辑到代码编写，">
<meta name="twitter:image" content="https://veinin.com/images/mvc/mvc_ui_design.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://veinin.com/2018/07/31/dev_notes-game-UI-semi-automated-development/"/>





  <title>开发笔记：游戏 UI 半自动化开发流程 | Veinin</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Veinin</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-booklist">
          <a href="/booklist/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            书单
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://veinin.com/2018/07/31/dev_notes-game-UI-semi-automated-development/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Veinin Guo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Veinin">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">开发笔记：游戏 UI 半自动化开发流程</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-31T20:10:00+08:00">
                2018-07-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/开发笔记/" itemprop="url" rel="index">
                    <span itemprop="name">开发笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/31/dev_notes-game-UI-semi-automated-development/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count gitment-comments-count" data-xid="/2018/07/31/dev_notes-game-UI-semi-automated-development/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>最近着手试了下我们客户端 UI 开发，发现整个流程对于开发人员来说并不是很友好，我们游戏客户端代码基本使用 Lua 语言进行，引擎则采用 Unity。对于 UI 模块目前有一套基本的 MVC 模式的开发流程，但这个开发模式的边界并没有处理很好，导致开发过程中异常艰难。编写代码的人员有时也会很懵逼，因为实现的方式可以有多种多样。</p>
<p>在了解了整个旧有的开发流程后，我发现个问题，其中由UI编辑到代码编写，这个流程中，大部分过程都是重复行工作，而针对这一部分重复行工作通过一些小工具可以让UI开发流程实现半自动化。</p>
<p>所谓半自动化，无非就是，开发人员不需要编写基本的UI代码，基础UI代码可以自动生成，包括整个开发流程中使用的各个UI窗口的组件都可以自动生成代码。</p>
<p>另外，因为UI编写过程中进程资源修改、代码修改，我希望都可以在修改完后立刻可以看到效果，而不是重启游戏。</p>
<p>下面是我对于一个半自动化的UI开发流程整理笔记。</p>
<a id="more"></a>
<h2 id="UI-编辑流程"><a href="#UI-编辑流程" class="headerlink" title="UI 编辑流程"></a>UI 编辑流程</h2><p>我们的 UI 编辑是一个独立的项目工程，通常一个功能的 UI 编辑会由策划完成一部分工作，程序人员拿过来，按需求再整理 UI 资源、编写代码即可。</p>
<ol>
<li>编辑器项目结构</li>
</ol>
<p>在UI编辑器中，其文件结构看起来是这样的：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">UIProject</span><br><span class="line">    -&gt; Assert</span><br><span class="line">        -&gt; PublicPrefabs - 公共UI</span><br><span class="line">        -&gt; PulibcResources - 公共资源</span><br><span class="line">        -&gt; Texture - 纹理</span><br><span class="line">        -&gt; UI</span><br><span class="line">            -&gt; LoginWindow - 登陆窗口UI</span><br><span class="line">                -&gt; Prefabs</span><br><span class="line">            -&gt; EquipWinodw - 装备窗口UI</span><br><span class="line">                -&gt; Prefabs</span><br><span class="line">            -&gt; TeamWindow  - 组队窗口UI</span><br><span class="line">                -&gt; Prefabs</span><br><span class="line">                    -&gt; TeamCreateView - 队伍创建窗口</span><br><span class="line">                    -&gt; TeamMemberView - 队员窗口</span><br><span class="line">                    -&gt; TeamMemberItem - 队员窗口队伍信息</span><br><span class="line">                    -&gt; ...</span><br><span class="line">                -&gt;  UI资源1.png</span><br><span class="line">                -&gt;  UI资源2.png</span><br><span class="line">                -&gt;  ...</span><br><span class="line">            -&gt; ...</span><br></pre></td></tr></table></figure>
<p>比如在一个组队功能UI里面，其他包含一个文件夹（TeamWindow），该文件夹下包含了多个UI用到的私有美术资源图片、纹理等。Window 文件夹下，有一个 Prefabs 文件夹，用来保存该功能所用到的所有子UI。</p>
<p>比如上面队伍窗口（TeamWindow）在UI设计中看起来是这样的：</p>
<p><img src="/images/mvc/mvc_ui_design.png" alt="mvc"></p>
<p>其包含3个View文件，两个主要窗口，CreateView用来创建队伍窗口，MemberView用来显示队伍成员窗口，而MemberItem用来显示队伍成员窗口下的队员详细。</p>
<p>2.UI文件打包</p>
<p>编辑好的UI会统一打包成一个文件，方便使用代码做资源一次性加载。比如上面TeamWindow，打包后一个统一的资源包文件，包含了上面所示的队伍UI下面的所有子窗口。</p>
<h2 id="MVC-设计模式"><a href="#MVC-设计模式" class="headerlink" title="MVC 设计模式"></a>MVC 设计模式</h2><p>原有的UI开发流程是使用 MVC 设计模式的，采用这个模式，如果能处理好，开发起来也是会很顺畅的。</p>
<p>对于 MVC，我们先用一张图来展示：</p>
<p><img src="/images/mvc/mvc_pattern.png" alt="mvc"></p>
<p>在 Unity UI 开发中引入 MVC 设计模式，它看起来是这样的：</p>
<h3 id="Model"><a href="#Model" class="headerlink" title="Model"></a>Model</h3><ul>
<li>其只是用来保存数据用的，其不能访问 View 或 Controller。</li>
<li>它可以被 Controller 和 View 直接访问。</li>
</ul>
<h3 id="View"><a href="#View" class="headerlink" title="View"></a>View</h3><ul>
<li>其只是游戏中能用户看到的 UI 布局。</li>
<li>View 可以处理 UI 点击逻辑、处理外面传进来的数据，可以访问和修改 Model。</li>
<li>在 Unity 中，每个 UI 资源的 Prefab 文件都会生成一个与之对应的 View 源代码文件。</li>
</ul>
<h3 id="Conroller"><a href="#Conroller" class="headerlink" title="Conroller"></a>Conroller</h3><ul>
<li>负责控制单个模块内所有 View 资源的加载、显示、关闭、数据更新、分组、层级控制等。</li>
<li>其持有所有 View 和 Model 对象。</li>
<li>其销毁后，所有View 和 Model 都会自动销毁。</li>
</ul>
<h2 id="MVC-实现"><a href="#MVC-实现" class="headerlink" title="MVC 实现"></a>MVC 实现</h2><p>对于上面所示的MVC模式，我们结合相关MVC特性，用实际代码来展示，下面实例统一采用 Lua 语言，并使用面向对象概念来设计。</p>
<h3 id="实现一个-Controller-接口"><a href="#实现一个-Controller-接口" class="headerlink" title="实现一个 Controller 接口"></a>实现一个 Controller 接口</h3><p>Controller 是一个UI功能的控制中心，其控制当前Window下的所有UI的加载、显示、隐藏，以及数据保存、清理、传递工作。<br>默认情况下所有子UI（UIView子类）都是会自动被其销毁的，其资源、数据都会在最后一个窗口关闭后自动清理掉。</p>
<p>Controller 接口完整生命周期示例图如下：</p>
<p><img src="/images/mvc/mvc_controller_life_cycle.png" alt="mvc"></p>
<p>实现的 Controller 接口代码如下：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> UIController = Class(<span class="string">'UIController'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UIController:Ctor</span><span class="params">(opts)</span></span></span><br><span class="line">    self.isInit         = <span class="literal">false</span></span><br><span class="line">    self.isPersistent   = opts.isPersistent <span class="comment">-- 是否持久化 model 数据，如果为 true，不会销毁 model 数据</span></span><br><span class="line">    self.prefabsName    = opts.prefabsName  <span class="comment">-- UI 打包后的资源名称</span></span><br><span class="line">    self.assets         = &#123;&#125;                <span class="comment">-- 已经加载的资源</span></span><br><span class="line"></span><br><span class="line">    self.model          = &#123;&#125;                <span class="comment">-- model 数据</span></span><br><span class="line"></span><br><span class="line">    self.viewClasses    = &#123;&#125;                <span class="comment">-- view 资源对应的子类，未实例化</span></span><br><span class="line">    self.openViews      = &#123;&#125;                <span class="comment">-- 已经打开的 view</span></span><br><span class="line">    self.openViewCount  = &#123;&#125;                <span class="comment">-- 已经打开的 view 数量</span></span><br><span class="line">    self.lastOpenData   = <span class="literal">nil</span>               <span class="comment">-- 上次打开 view 时的数据（未初始化时需要先保存打开时数据，初始化完成后再打开）</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UIController:IsInit</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">return</span> self.isInit</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">OnLoad</span><span class="params">(self, assets)</span></span></span><br><span class="line">    <span class="keyword">for</span> _, asset <span class="keyword">in</span> <span class="built_in">ipairs</span>(assets) <span class="keyword">do</span></span><br><span class="line">        self.assets[asset.name] = asset</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    self.isInit = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">next</span>(self.viewClasses) <span class="keyword">then</span></span><br><span class="line">        self:OnInitView()</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> self.lastOpenData <span class="keyword">then</span></span><br><span class="line">        self.Open(<span class="built_in">unpack</span>(self.lastOpenData))</span><br><span class="line">        self.lastOpenData = <span class="literal">nil</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        self:OnDefaultOpen()</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UIController:Init</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">if</span> self:IsInit() <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    LoadManager:LoadPrefab(self.prefabsName, <span class="function"><span class="keyword">function</span><span class="params">(assets)</span></span></span><br><span class="line">        OnLoad(self, assets)</span><br><span class="line">    <span class="keyword">end</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UIController:OnInitView</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UIController:RegisterView</span><span class="params">(class)</span></span></span><br><span class="line">    <span class="built_in">assert</span>(self.viewClasses[class.name] == <span class="literal">nil</span>)</span><br><span class="line">    self.viewClasses[class.name] = class</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">CreateView</span><span class="params">(self, name)</span></span></span><br><span class="line">    <span class="keyword">local</span> class = self.viewClasses[name]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> class <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">local</span> view = class.New()</span><br><span class="line">    view.controller = self</span><br><span class="line">    view.model      = self.model</span><br><span class="line"></span><br><span class="line">    self.openViews[name] = view</span><br><span class="line">    self.openViewCount = self.openViewCount + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> view</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">GetView</span><span class="params">(self, name)</span></span></span><br><span class="line">    <span class="keyword">local</span> view = self.openViews[name]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> view <span class="keyword">then</span></span><br><span class="line">        view = CreateView(self, name)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> view <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> view:IsState(UIConst.LIFESTATE.NONE) <span class="keyword">then</span></span><br><span class="line">        UIHelper.InitView(self, view)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> view</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UIController:Open</span><span class="params">(name, ...)</span></span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> self:IsInit() <span class="keyword">then</span></span><br><span class="line">        self.lastOpenData = &#123;name, ...&#125;</span><br><span class="line">        self:Init()</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">local</span> view = GetView(self, name)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> view <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> view:IsState(UIConst.LIFESTATE.SHOW) <span class="keyword">then</span></span><br><span class="line">        view:Update(...)</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        view:Open(...)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UIController:Close</span><span class="params">(view)</span></span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> view <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    GameObject.Destroy(view.gameObject)</span><br><span class="line"></span><br><span class="line">    self.openViews[name] = <span class="literal">nil</span></span><br><span class="line">    self.openViewCount = self.openViewCount - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> self.openViewCount == <span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">        self:Dispose()</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UIController:Dispose</span><span class="params">()</span></span></span><br><span class="line">    self.isInit = <span class="literal">false</span></span><br><span class="line">    self.assets = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    LoadManager:RemovePrefab(self.prefabsName)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> self.isPersistent <span class="keyword">then</span></span><br><span class="line">        self.model = &#123;&#125;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    self:OnDispose()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UIController:OnDispose</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> UIController</span><br></pre></td></tr></table></figure>
<p>根据上面生命周期实例图和代码实现，我们可以看到 Contoller 入口有两个，一个是外部打开指定 View，一个是外部关闭指定 View。</p>
<p>当外部需要打开指定 View 时，我们先检查当前 Controller 是否初始化完成，如果未初始化，则先临时保存打开时的数据，然后再走初始化 Controller 逻辑，加载 UI 资源。</p>
<p>当加载 UI 资源完成后，我们通过 View 的名称，调用 <code>GetView()</code> 函数获取一个 View 对象，如果 View 对象未创建，则走创建对象逻辑 <code>CreateView()</code>，并调用 View 初始化逻辑（下一节详解）。</p>
<p>获取到 View 对象后，如果 View 是打开状态则调用 <code>UIView.Update(...)</code> 函数更新，关闭状态则调用 <code>UIView:Open(...)</code> 函数打开。</p>
<p>UIController 对外暴露一个公共接口：</p>
<ul>
<li><code>UIController.Open(name, ...)</code>，用于外部打开指定 View 。</li>
<li><code>UIController.RegisterView(class)</code>，用于注册一个 View 子类，通过其来实例化相应的 UI 窗口。</li>
<li><code>UIController.Close(view)</code>，用于关闭一个 View，这个接口用于 View 为了关闭自己而调用。</li>
</ul>
<p>UIController 作为一个父类，需要子类重写以下接口：</p>
<ul>
<li><code>UIController.OnInitView()</code>，初始化所有View，调用 <code>RegisterView</code> 注册指定 View。</li>
<li><code>UIController.OnDispose()</code>，销毁整个 Controller 的后续处理。</li>
</ul>
<h3 id="实现一个-View-接口"><a href="#实现一个-View-接口" class="headerlink" title="实现一个 View 接口"></a>实现一个 View 接口</h3><p>View 接口是所有UI资源窗口的父类，子类通过继承方式实现一个UI子窗口显示。<br>View 子类可以直接访问和修改 model 数据，另外，我希望在 View 中能间接调用 Controller 打开其他窗口。</p>
<p>View 接口完整生命周期示例图如下：</p>
<p><img src="/images/mvc/mvc_view_life_cycle.png" alt="mvc"></p>
<p>根据上面生命周期实例图，我们可以看出整个 View 对象从初始化到关闭的完整生命周期流程。我们把 View 生命周期状态分为3部分：</p>
<ul>
<li>NONE，未初始化状态</li>
<li>HIDE，隐藏状态</li>
<li>SHOW，打开状态</li>
</ul>
<p>根据上面的状态图，我们先实现 View 接口代码如下：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> UIView = Class(<span class="string">'UIView'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UIView:Ctor</span><span class="params">()</span></span></span><br><span class="line">    self.controller    = <span class="literal">nil</span> <span class="comment">-- 持有 View 的 UIController 对象</span></span><br><span class="line">    self.model         = <span class="literal">nil</span> <span class="comment">-- View 持有的 Model 数据，与 UIController 共享</span></span><br><span class="line"></span><br><span class="line">    self.gameObject    = <span class="literal">nil</span>   <span class="comment">-- 引擎对象，该对象保存着UI资源</span></span><br><span class="line">    self.isAutoDestroy = <span class="literal">false</span> <span class="comment">-- 是否自动销毁，默认关闭时直接销毁对象，如果不自动销毁，关闭动作时隐藏</span></span><br><span class="line">    self.layer         = UIConst.LAYER.MIDDLE   <span class="comment">-- UI 层级（高、中、低）</span></span><br><span class="line">    self.lifeState     = UIConst.LIFESTATE.NONE <span class="comment">-- UI 生命周期状态</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UIView:IsState</span><span class="params">(state)</span></span></span><br><span class="line">    <span class="keyword">return</span> self.lifeState == state</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UIView:Init</span><span class="params">()</span></span></span><br><span class="line">    self.gameObject:SetActive(<span class="literal">false</span>)</span><br><span class="line">    self.lifeState = UIConst.LIFESTATE.HIDE</span><br><span class="line">    self:OnInit()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UIView:OpenView</span><span class="params">(name, ...)</span></span></span><br><span class="line">    self.controller:Open(name, ...)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UIView:Open</span><span class="params">(...)</span></span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> self:IsState(UIConst.LIFESTATE.HIDE) <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    self.lifeState = UIConst.LIFESTATE.SHOW</span><br><span class="line">    self.gameObject:SetActive(<span class="literal">true</span>)</span><br><span class="line">    self:OnShow(...)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UIView:Update</span><span class="params">(...)</span></span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> self:IsState(UIConst.LIFESTATE.SHOW) <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    self:OnUpdate(...)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UIView:Close</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> self:IsState(UIConst.LIFESTATE.SHOW) <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    self:OnHide()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> self.isAutoDestroy <span class="keyword">then</span></span><br><span class="line">        self.controller:Close(self)</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        self.gameObject:SetActive(<span class="literal">false</span>)</span><br><span class="line">        self.lifeState = UIConst.LIFE_STATE.HIDE</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UIView:OnInit</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UIView:OnShow</span><span class="params">(...)</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UIView:OnUpdate</span><span class="params">(...)</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UIView:OnHide</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> UIView</span><br></pre></td></tr></table></figure>
<p>View 初始化时，会从引擎底层加载 UI 编辑器指定的 UI 组件到 View 对象，这一步是 Contoller 在创建 View 时执行的，我们可以看到 <code>UIContoller.GetView()</code> 函数调用时，判断当前 View 对象如果是未初始化状态则调用帮助函数 <code>UIHelper.InitView()</code> 加载所有 UI 组件对象，其加载代码看起来时这样的：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> UIHelper = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Lua 封装的 UI 组件对象</span></span><br><span class="line"><span class="keyword">local</span> UI_TYPES = &#123;</span><br><span class="line">    [<span class="string">'UIButton'</span>]        = <span class="built_in">require</span>(<span class="string">"game.ui.component.UIButton"</span>),</span><br><span class="line">    [<span class="string">'UILabel'</span>]         = <span class="built_in">require</span>(<span class="string">"game.ui.component.UILabel"</span>),</span><br><span class="line">    [<span class="string">'UIInputField'</span>]    = <span class="built_in">require</span>(<span class="string">"game.ui.component.UIInputField"</span>),</span><br><span class="line">    <span class="comment">-- 其他 UI 组件...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建引擎 UI 对象</span></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">CreateCSObject</span><span class="params">()</span></span></span><br><span class="line">    <span class="comment">-- TODO 创建引擎UI对象，设置其层级关系</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 初始化所以 UI 组件Lua对象</span></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">InitComponents</span><span class="params">(view)</span></span></span><br><span class="line">    <span class="keyword">local</span> components = view.gameObject.components</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _, component <span class="keyword">in</span> <span class="built_in">ipairs</span>(components) <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">local</span> uiLuaClass = UI_TYPES[component.typeName]</span><br><span class="line">        <span class="keyword">if</span> uiLuaClass <span class="keyword">then</span></span><br><span class="line">            view[component.key] = uiLuaClass.New(component.value)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 初始化 UIView 对象</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UIHelper.InitView</span><span class="params">(view)</span></span></span><br><span class="line">    view.gameObject = CreateCSObject(view)</span><br><span class="line"></span><br><span class="line">    InitComponents(view)</span><br><span class="line"></span><br><span class="line">    view:Init()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> UIHelper</span><br></pre></td></tr></table></figure>
<p>在我们可以看到所有 UI 组件都在 Lua 层有一个简单的封装对象，我们在 UI 编辑器指定 UI 组件名称和类型后，在加载完 View 对象后，其 UI 组件就被赋予给了 View 对象。下面给出了一个按钮组件的简单封装实例：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> UIButton = Class(<span class="string">'UIButton'</span>, UIBehaviour)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UIButton:SetText</span><span class="params">(name)</span></span></span><br><span class="line">    self.core.text = name</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UIButton:SetEnable</span><span class="params">(isEnable)</span></span></span><br><span class="line">    self.core:SetEnable(isEnable)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UIButton:AddListener</span><span class="params">(callback, delayTime)</span></span></span><br><span class="line">    delayTime = delayTime <span class="keyword">or</span> <span class="number">0.3</span></span><br><span class="line">    self.event.onClickLua = callback</span><br><span class="line">    self.event.clickDelayTime = delayTime</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> UIButton</span><br></pre></td></tr></table></figure>
<p>View 初始化完成后，每次打开时，都会传入打开时需要的数据，我们根据状态，把数据传给不同的处理函数。当前 UI 处于打开状态时调用 <code>UIView.Open()</code>；处于显示状态，则调用 <code>UIView.Update()</code>。最后可以使用 <code>UIView.Close()</code> 关闭 View。</p>
<p>UIView 对外暴露一个公共接口：</p>
<ul>
<li><code>UIView.Init()</code>，初始化 View，初始化完成后调用一次 <code>UIView.OnInit()</code>。</li>
<li><code>UIView.Open(...)</code>，当 View 处于隐藏状态时，打开 View，最终会调用 <code>UIView.OnShow()</code> 处理。</li>
<li><code>UIView.Update(...)</code>，当 View 处于打开状态时，更新 View 数据，最终会调用 <code>UIView.OnUpdate()</code> 处理。</li>
<li><code>UIView.Close(...)</code>，用于关闭当前 UI，并调用 <code>UIView.OnHide()</code> 处理 View 隐藏后逻辑，其资源清理逻辑最终会交给 Controller 执行。</li>
<li><code>UIView.OpenView(name)</code>，用于打开其他 View，其打开逻辑会交给 Controller 执行。</li>
</ul>
<p>UIView 作为一个父类，需要子类重写以下接口：</p>
<ul>
<li><code>UIView.OnInit()</code>，初始化View，我们需要做一些 UI 组件事件注册逻辑处理，如果某个按钮点击后的逻辑，因为这些逻辑固定不变的，整个 View 生命周期只会调用过一次。</li>
<li><code>UIView.OnShow()</code>，如果 View 隐藏状态，在打开 View 时，会调用此函数，并传入打开 UI 时需要处理的数据。</li>
<li><code>UIView.OnUpdate()</code>，如果 View 打开状态，在打开 View 时，会调用此函数，并传入打开 UI 时需要处理的数据。</li>
<li><code>UIView.OnHide()</code>，当 View 被调用 UIView.Close(…) 时，在销毁前，会被调用，需要在此函数内处理关闭 View 时的逻辑。</li>
</ul>
<h2 id="View-分组"><a href="#View-分组" class="headerlink" title="View 分组"></a>View 分组</h2><p>在复杂的游戏 UI 功能开发时，常常遇到这些的问题：</p>
<ul>
<li>同一个 UI 窗口内，我们希望某一组 UI 是互斥的，即同一时间内，Controller 只能打开该组内的某一个 View，如果同组有其他 View 打开则先关闭一打开的 View。</li>
<li>有一些 UI 分组，在某个指定 UI 关闭后，其分组内的任何 UI 只要打开都会自动关闭。</li>
</ul>
<p>看到这些需求后，我们很快想到使用一颗树来管理这些 UI View 分组。其分组示例图如下：</p>
<p><img src="/images/mvc/mvc_view_group.png" alt="mvc"></p>
<p>从图中我们可以看到，这是一个树形结构的 UI 分组，有一个根节点，子节点之间是分层的，每一层节点之间可以设置未互斥状态，即同一时间内，只能被打开一个。<br>有了这个树形结构，当某个节点被关闭后，我们可以很快获取到这个节点的所有子节点，并关闭它们。</p>
<p>于是可以设计一个 UI 分组代码：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> Tree = <span class="built_in">require</span> <span class="string">"game.foundation.Tree"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> UIGroupTree = Class(<span class="string">'UIGroupTree'</span>, Tree)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UIGroupTree:Ctor</span><span class="params">()</span></span></span><br><span class="line">    self.isExclusion = <span class="literal">true</span> <span class="comment">-- 子节点是否互斥，默认未互斥</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UIGroupTree:SetExclusion</span><span class="params">(isExclusion)</span></span></span><br><span class="line">    self.isExclusion = isExclusion</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UIGroupTree:IsExclusion</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">return</span> self.isExclusion</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UIGroupTree:AddChildUI</span><span class="params">(view)</span></span></span><br><span class="line">    <span class="keyword">return</span> self.NewChild(view.name)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> UIGroupTree</span><br></pre></td></tr></table></figure>
<p>代码中树形结构 <code>Tree</code> 实现请参考外部 <a href="https://gist.github.com/Veinin/a9fbf71f6a82938100dff7fbff501495" target="_blank" rel="noopener">链接</a>。</p>
<p>然后我们拓展 Contoller 接口实现：</p>
<ul>
<li>加入新的成员变量 group (UIGroupTree类型)</li>
<li>加入创建 UI 分组对象函数，<code>UIController.NewGroup(view)</code>，用于创建一个分组。</li>
<li>加入新的抽象函数 <code>UIController.OnInitGroup()</code>，子类如需要UI分组，则重写该函数，该函数在 Controller 初始化时被调用。</li>
<li>打开某个 UI 时检查 View 对象是否分组、分组是否互斥、是否有互斥 View 已打开，如果打开则关闭互斥 View。</li>
<li>关闭某个 UI 时检查 View 对象是否分组，当前节点是否存在子节点，子节点是否有打开情况，如果打开则关闭 View。</li>
</ul>
<p>扩展 Controller 的代码实现如下：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> UIGroupTree = <span class="built_in">require</span> <span class="string">"game.ui.group.UIGroupTree"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> UIController:Ctor()</span><br><span class="line">    <span class="comment">-- 上面已实现代码省略...</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">OnLoad</span><span class="params">(self, assets)</span></span></span><br><span class="line">    <span class="comment">-- 上面已实现代码省略...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">next</span>(self.viewClasses) <span class="keyword">then</span></span><br><span class="line">        <span class="comment">-- ...</span></span><br><span class="line">        self:OnInitGroup()</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">-- ...</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UIController:OnInitGroup</span><span class="params">()</span></span></span><br><span class="line">    <span class="comment">-- 子类实现</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建一个UI分组</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UIController:NewGroup</span><span class="params">(view)</span></span></span><br><span class="line">    <span class="built_in">assert</span>(self.group == <span class="literal">nil</span>, <span class="string">"不允许创建多个分组"</span>)</span><br><span class="line">    self.group = UIGroupTree.New(view.name)</span><br><span class="line">    <span class="keyword">return</span> self.group</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 检查互斥</span></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">CheckExclusion</span><span class="params">(self, view)</span></span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> self.group <span class="keyword">or</span> self.openViewCount == <span class="number">1</span> <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">local</span> name = view.name</span><br><span class="line">    <span class="keyword">local</span> node = self.group:FindChild(name)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> node <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">local</span> parent = node:GetParent()</span><br><span class="line">    <span class="keyword">if</span> #parent == <span class="number">0</span> <span class="keyword">or</span> <span class="keyword">not</span> parent:IsExclusion() <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">local</span> childName</span><br><span class="line">    <span class="keyword">local</span> childView</span><br><span class="line">    <span class="keyword">for</span> _, child <span class="keyword">in</span> <span class="built_in">ipairs</span>(parent) <span class="keyword">do</span></span><br><span class="line">        childName = child.name</span><br><span class="line">        childView = self.openViews[childName]</span><br><span class="line">        <span class="keyword">if</span> childName ~= name <span class="keyword">and</span> childView <span class="keyword">then</span> <span class="comment">-- 如果打开则关闭</span></span><br><span class="line">            self:Close(childView)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UIController:Open</span><span class="params">(name, ...)</span></span></span><br><span class="line">    <span class="comment">-- ...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 打开前检查分组互斥</span></span><br><span class="line">    CheckExclusion(self, view)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> view:IsState(UIConst.LIFESTATE.SHOW) <span class="keyword">then</span></span><br><span class="line">        view:Update(...)</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        view:Open(...)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 检查子节点关闭</span></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">CheckCloseChild</span><span class="params">(self, view)</span></span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> self.group <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">local</span> name = view.name</span><br><span class="line">    <span class="keyword">local</span> node = self.group:FindChild(name)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> node <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">local</span> childView</span><br><span class="line">    node:IterativeChildren(<span class="function"><span class="keyword">function</span><span class="params">(child)</span></span></span><br><span class="line">        childView = self.openViews[child.value]</span><br><span class="line">        <span class="keyword">if</span> childView <span class="keyword">then</span>  <span class="comment">-- 如果子节点打开则关闭</span></span><br><span class="line">            self:Close(childView)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UIController:Close</span><span class="params">(view)</span></span></span><br><span class="line">    <span class="comment">-- ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> self.openViewCount == <span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">        self:Dispose()</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="comment">-- 还有打开的 View，检查是否其子节点，并关闭</span></span><br><span class="line">        CheckCloseChild(self, view)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> UIController</span><br></pre></td></tr></table></figure>
<p>有了上面扩展实现的代码，我们就实现分组示例图中展示的分组结构：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyTestController:OnInitGroup</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">local</span> root = self:NewGroup(UIView1)</span><br><span class="line">    root:AddChild(UIView2)</span><br><span class="line">    root:AddChild(UIView3)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">local</span> child = root:AddChild(UIView4)</span><br><span class="line">    child:AddChild(UIView5)</span><br><span class="line">    child:AddChild(UIView6)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h2 id="UI-开发半自动化"><a href="#UI-开发半自动化" class="headerlink" title="UI 开发半自动化"></a>UI 开发半自动化</h2><p>我们知道，游戏 UI 开发，很多固定的流程其实是可以省略的：</p>
<ul>
<li>UI 编辑完成后，开始写业务代码时，可以将所有基础代码全部生成，比如上面的 Controller 子类和每个窗口的 View 子类。</li>
<li>每个 View 类型，我们设计时其会对应 UI 编辑器的一个界面，且 UI 编辑器里面的所有组件，都是可以读取到的，在 Unity 中，我们保存为 Prefab 文件，而这个文件可以帮助我们设计一个自动生成代码的工具。</li>
<li>每次修改 UI 增加了新的组件后，我们希望原有的已经编辑的代码可以保留，在编辑器中刷新一下代码，能将新增加的控件基础代码直接加入到相应的代码文件里面。</li>
<li>每次修改完 UI 资源后，然后对应改完代码后，不希望在游戏中重启客户端才能看到效果，所以，我们加入了热更机制，任何代码都是可以热更新的，那么 UI 开发人员编码阶段将会非常方便。</li>
</ul>
<p>综上考虑，因为我们项目很多人使用 <strong>IntelliJ IDEA</strong> 配合一个不错的 Lua 插件 <strong>EmmyLua</strong>， 相对来说使用 Lua 开发还是比较顺畅的。所以决定在 <strong>IntelliJ IDEA</strong> 平台上开发一个为项目定制的 UI 开发插件（当然现在一些主流的代码编辑器都支持插件编写，你可以很容易在其他编辑器中实现这些内容）。</p>
<p>在UI编辑完成后，开发人员，建立 UI 功能开发文件夹后，右键菜单点击生成代码，插件自动生成 UIController 和 UIView 对应子类。</p>
<p>比如一个组队功能包含以下 UI 文件:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">-&gt;</span> TeamWindow</span><br><span class="line">    -&gt; Prefabs</span><br><span class="line">        -&gt; CreateView.prefab</span><br><span class="line">        -&gt; MemberView.prefab</span><br><span class="line">        -&gt; MemberItem.prefab</span><br></pre></td></tr></table></figure>
<p>生成的代码文件夹：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">-&gt;</span> team</span><br><span class="line">    -&gt; contoller</span><br><span class="line">        -&gt; TeamController.lua</span><br><span class="line">    -&gt; views</span><br><span class="line">        -&gt; CreateView.lua</span><br><span class="line">        -&gt; MemberView.lua</span><br><span class="line">    -&gt; protocol</span><br><span class="line">        -&gt; TeamProtocol.lua -- 协议文件，项目定制</span><br></pre></td></tr></table></figure>
<p>下面是 Contoller 实例 <code>TeamController.lua</code> 文件内容，该文件自动生成了很多基础的代码，需要填写的地方只剩下分组（如需要）：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> UIController = <span class="built_in">require</span> <span class="string">"game.ui.core.UIController"</span></span><br><span class="line"><span class="keyword">local</span> CreateView = <span class="built_in">require</span> <span class="string">"game.ui.team.views.CreateView"</span></span><br><span class="line"><span class="keyword">local</span> MemberView = <span class="built_in">require</span> <span class="string">"game.ui.team.views.MemberView"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> TeamController = Class(<span class="string">'TeamController'</span>, UIController)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">TeamController:OnInitView</span><span class="params">()</span></span></span><br><span class="line">    self:RegisterView(CreateView)</span><br><span class="line">    self:RegisterView(MemberView)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">funciton TeamController:OnInitGroup()</span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> TeamController</span><br></pre></td></tr></table></figure>
<p>下面是一个 View 实例 CreateView.lua 文件内容，其基本的组件代码全部通过编辑器UI文件自动生成，开发人员只需要在对应的 UI 组件填入相对于的业务逻辑即可：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> UIView = <span class="built_in">require</span> <span class="string">"game.ui.core.UIView"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> CreateView = Class(<span class="string">'CreateView'</span>, UIView)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CreateView:Ctor</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CreateView:OnInit</span><span class="params">()</span></span></span><br><span class="line">    self.closeButton:AddListener(<span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">        self:Close()</span><br><span class="line">    <span class="keyword">end</span>)</span><br><span class="line"></span><br><span class="line">    self.cofirmButton:AddListener(<span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">        <span class="comment">-- 开发人员实现创建队伍逻辑</span></span><br><span class="line">    <span class="keyword">end</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CreateView:OnShow</span><span class="params">(...)</span></span></span><br><span class="line">    self.nameInputField:SetText()</span><br><span class="line">    self.fightINputField:SetText()</span><br><span class="line">    self.levelInputField:SetText()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CreateView:OnUpdate</span><span class="params">(...)</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CreateView:OnHide</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> CreateView</span><br></pre></td></tr></table></figure>
<p>为了对比，下面展示以下 <code>CreateView.lua</code> 对应 <code>CreateView.prefab</code> 文件结构：</p>
<p><img src="/images/mvc/create_view.png" alt="mvc"></p>
<p>可以看出这个 UI 有5个需要处理的组件，两个按钮（关闭、确定），3个输入文本框（队伍名称、队伍战力、最低等级）。我们可以很容易从编辑的 prefab 文件中提取到里面的 UI 组件，然后通过插件直接生成代码文件。</p>
<p>有了上面的这些自动生成的代码，剩下的工作，其实就是填写一些基础的业务逻辑，那些重复性的工作工具已经可以帮你很好的完成了。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本文阐述了一个半自动化工作的游戏 UI 编写流程，并给出了实现步骤。<br>游戏 UI 开发流程存在大部分重复工作，我们稍微花点时间，其实是可以把这些重复工作自动化的，剩下的工作，无非就是填写下业务逻辑代码。<br>可以预见的是，开发这么一套半自动化的工具其实不到一周时间，其实是可以很容易搞定的，并且后续的 UI 开发效率其实是提升了一个档次。</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/半自动化，游戏UI开发，Unity/" rel="tag"># 半自动化，游戏UI开发，Unity</a>
          
            <a href="/tags/MVC/" rel="tag"># MVC</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/06/25/programming_with_posix_pthreads_08/" rel="next" title="POSIX 多线程程序设计-线程同步精要">
                <i class="fa fa-chevron-left"></i> POSIX 多线程程序设计-线程同步精要
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/08/07/ai_behavior_tree_design_and_implementation_01/" rel="prev" title="AI 行为树设计与实现-理论篇">
                AI 行为树设计与实现-理论篇 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      
        <div id="gitment-container"></div>
      
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.png"
                alt="Veinin Guo" />
            
              <p class="site-author-name" itemprop="name">Veinin Guo</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">44</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">51</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/veinin" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:veininguo@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="http://weibo.com/veinin" target="_blank" title="微博">
                      
                        <i class="fa fa-fw fa-globe"></i>微博</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.douban.com/people/97080173" target="_blank" title="豆瓣">
                      
                        <i class="fa fa-fw fa-globe"></i>豆瓣</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#UI-编辑流程"><span class="nav-number">1.</span> <span class="nav-text">UI 编辑流程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MVC-设计模式"><span class="nav-number">2.</span> <span class="nav-text">MVC 设计模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Model"><span class="nav-number">2.1.</span> <span class="nav-text">Model</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#View"><span class="nav-number">2.2.</span> <span class="nav-text">View</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Conroller"><span class="nav-number">2.3.</span> <span class="nav-text">Conroller</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MVC-实现"><span class="nav-number">3.</span> <span class="nav-text">MVC 实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#实现一个-Controller-接口"><span class="nav-number">3.1.</span> <span class="nav-text">实现一个 Controller 接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实现一个-View-接口"><span class="nav-number">3.2.</span> <span class="nav-text">实现一个 View 接口</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#View-分组"><span class="nav-number">4.</span> <span class="nav-text">View 分组</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#UI-开发半自动化"><span class="nav-number">5.</span> <span class="nav-text">UI 开发半自动化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#总结"><span class="nav-number">6.</span> <span class="nav-text">总结</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Veinin Guo</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  







<!-- LOCAL: You can save these files to your site and update links -->
    
        
        <link rel="stylesheet" href="https://aimingoo.github.io/gitmint/style/default.css">
        <script src="https://aimingoo.github.io/gitmint/dist/gitmint.browser.js"></script>
    
<!-- END LOCAL -->

    

    
      <script type="text/javascript">
      function renderGitment(){
        var gitment = new Gitmint({
            id: window.location.pathname, 
            owner: 'Veinin',
            repo: 'Gitment',
            
            lang: "" || navigator.language || navigator.systemLanguage || navigator.userLanguage,
            
            oauth: {
            
            
                client_secret: '9deb0ffa39d2e542a066c1b8ccd66c798fef2cd6',
            
                client_id: '675fbd84b4d35820edf5'
            }});
        gitment.render('gitment-container');
      }

      
      renderGitment();
      
      </script>
    







  





  

  

  

  
  

  

  

  

</body>
</html>
